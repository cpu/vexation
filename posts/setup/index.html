<!doctype html><html lang=en-us><head><title>Getting set up | VeXation</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Setting up Win95, file sharing, and Borland Turbo Assembler 5.0"><meta name=generator content="Hugo 0.99.1"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon></head><body><nav class=navigation><a href=/><span class=arrow>‚Üê</span>Home</a>
<a href=/posts>Archive</a>
<a href=/about>About</a>
<a class=button href=https://log.vexation.ca/index.xml>Subscribe</a></nav><main class=main><section id=single><h1 class=title>Getting set up</h1><div class=tip><time datetime="2019-01-17 00:00:00 +0000 UTC">Jan 17, 2019</time></div><aside class=toc><details><summary>Table of Contents</summary><div><nav id=TableOfContents><ul><li><a href=#software-choices>Software Choices</a><ul><li><a href=#virtualization>Virtualization</a></li><li><a href=#windows-95-version>Windows 95 Version</a></li><li><a href=#assemblerlinkerdebugger>Assembler/Linker/Debugger</a></li><li><a href=#text-editor>Text Editor</a></li></ul></li><li><a href=#installing-windows-95-osr-21>Installing Windows 95 OSR 2.1</a><ul><li><a href=#setting-up-file-sharing>Setting up File Sharing</a></li></ul></li><li><a href=#installing-borland-turbo-assembler-50>Installing Borland Turbo Assembler 5.0</a></li><li><a href=#wrapping-up>Wrapping Up</a></li></ul></nav></div></details></aside><div class=content><p>Virus writing starts with a development environment. Here&rsquo;s how I set up a Windows 95 VM and my development tools. If this is your first visit to VeXation you might want to start by reading the <a href=../welcome>&ldquo;Welcome&rdquo; post introducing the project</a>.</p><p>Before going too far I think its valuable to get into a 1995 mindset: Coolio&rsquo;s <a href="https://www.youtube.com/watch?v=fPO76Jlnz6c" target=_blank rel=noopener>Gangster&rsquo;s Paradise</a> is the <a href=https://en.wikipedia.org/wiki/Billboard_Year-End_Hot_100_singles_of_1995 target=_blank rel=noopener>#1 single</a>. Quebec <a href=https://en.wikipedia.org/wiki/1995_Quebec_referendum target=_blank rel=noopener>narrowly remains a province of Canada</a>. A pog collection was <a href=https://www.complex.com/style/the-rarest-pogs-from-the-90s/ target=_blank rel=noopener>still cool</a>. Netscape only recently released SSL and faces challenge from a brand new web browser called Internet Explorer. A top of the line home PC was something like a <a href=http://file.vintageadbrowser.com/pdvne4ihtorfz3.jpg target=_blank rel=noopener>486 with a 1 GB harddrive and a whopping 8mb of RAM</a>.</p><p>Let&rsquo;s take this new Windows 95 thing for a spin.</p><p><p class=markdown-image><figure><a href=/posts/setup/win95.get.hype.jpg><picture><source media="(max-width: 420px)" srcset=/posts/setup/win95.get.hype_hu5438825b9b6d1014226d20d231e650c2_97358_400x0_resize_q75_h2_box.webp><source media="(max-width: 920px)" srcset=/posts/setup/win95.get.hype_hu5438825b9b6d1014226d20d231e650c2_97358_600x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/posts/setup/win95.get.hype_hu5438825b9b6d1014226d20d231e650c2_97358_800x0_resize_q75_h2_box.webp><img alt="Windows 95 launch day photo" title="Windows 95 launch day photo" src=win95.get.hype.jpg loading=lazy class=img-fluid></picture></a><figcaption>Get hype, we're installing Windows 95!</figcaption></figure></p></p><h1 id=software-choices>Software Choices <a href=#software-choices class=anchor>üîó</a></h1><h2 id=virtualization>Virtualization <a href=#virtualization class=anchor>üîó</a></h2><p>I&rsquo;m writing this post from Linux and will be using <a href=https://www.virtualbox.org/ target=_blank rel=noopener>VirtualBox</a> for virtualization. There are other ways to run Windows95 but <strong>VirtualBox</strong> is the devil I know. In theory most of this setup could be adapted to macOS or modern Windows but you&rsquo;ll have to try that on your own. Luckily for me most of the hard work involved in setting up Windows 95 with VirtualBox was covered by <a href=https://socket3.wordpress.com/2016/09/06/install-configure-windows-95-using-oracle-virtualbox/ target=_blank rel=noopener>Socket3&rsquo;s blog post on the subject</a>. Rather than duplicate that effort I will defer to that post for the basic setup instructions and only point out areas of difference.</p><h2 id=windows-95-version>Windows 95 Version <a href=#windows-95-version class=anchor>üîó</a></h2><p>There are a number of versions of Windows 95 available. To make things simple I chose to use the same one as Socket3: <strong>Windows 95 OSR 2.1</strong>. Later on I&rsquo;ll want to test code on a few versions to make sure differences in patch level don&rsquo;t break things.</p><h2 id=assemblerlinkerdebugger>Assembler/Linker/Debugger <a href=#assemblerlinkerdebugger class=anchor>üîó</a></h2><p>I don&rsquo;t know if its true but I get the impression the prevailing choice for writing <code>ASM</code> malware in the 90s was <a href=https://en.wikipedia.org/wiki/Microsoft_Macro_Assembler target=_blank rel=noopener>Microsoft Macro Assembler</a> (almost always referred to as <code>MASM</code>). To spice things up a little bit I decided it would be fun to try using Borland <a href=https://en.wikipedia.org/wiki/Turbo_Assembler target=_blank rel=noopener>Turbo Assembler</a> (almost always referred to as <code>TASM</code>). I ended up choosing <strong>Borland Turbo Assembler 5.0</strong>. It was easy to install and supported 32bit Win32 development. <code>TASM</code> has fairly extensive <code>MASM</code> compatibility so this turned out to be an OK decision. If all else fails it&rsquo;s fun to say &ldquo;Borland&rdquo; out loud (I recommend you try it).</p><p><p class=markdown-image><figure><a href=/posts/setup/tasm5.jpg><picture><source media="(max-width: 420px)" srcset=/posts/setup/tasm5_hu283ba7d88f0c04f5151224750ad52928_11085_400x0_resize_q75_h2_box.webp><source media="(max-width: 920px)" srcset=/posts/setup/tasm5_hu283ba7d88f0c04f5151224750ad52928_11085_600x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/posts/setup/tasm5_hu283ba7d88f0c04f5151224750ad52928_11085_800x0_resize_q75_h2_box.webp><img alt="Turbo Assembler Box Art" title="Turbo Assembler Box Art" src=tasm5.jpg loading=lazy class=img-fluid></picture></a><figcaption>Are you ready to pinch individual MOV instructions? I sure am!</figcaption></figure></p></p><h2 id=text-editor>Text Editor <a href=#text-editor class=anchor>üîó</a></h2><p>This part was a real struggle. I tried a few random &ldquo;Programmer&rsquo;s Text Editors&rdquo; that I could remember (Notepad++, UltraEdit, etc) but couldn&rsquo;t get any of them to install on a fresh Windows 95 OSR 2.1 system. This was probably because I was using newer versions meant for Win98+ but it was tedious digging up old installers to try. Ultimately I ended up choosing an ancient freeware program called the <a href=https://www.lancaster.ac.uk/~steveb/cpaap/pfe/ target=_blank rel=noopener>Programmer&rsquo;s File Editor</a> (PFE). Compared to a modern IDE it is somewhat feature bare but it sure is&mldr; <em>&ldquo;authentic&rdquo;</em>. Using <strong>Programmer&rsquo;s File Editor</strong> does provide important features missing from notepad.exe like line numbers and being able to open files > 64KB. Best of all PFE is <a href=https://www.lancaster.ac.uk/~steveb/cpaap/pfe/year2000.htm target=_blank rel=noopener><em>probably</em> Y2K safe</a>.</p><p><p class=markdown-image><figure><a href=/posts/setup/pfe.logo.jpg><picture><source media="(max-width: 420px)" srcset=/posts/setup/pfe.logo_hufca334f4a48913bd27e4d907ac2dddc7_19573_400x0_resize_q75_h2_box.webp><source media="(max-width: 920px)" srcset=/posts/setup/pfe.logo_hufca334f4a48913bd27e4d907ac2dddc7_19573_600x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/posts/setup/pfe.logo_hufca334f4a48913bd27e4d907ac2dddc7_19573_800x0_resize_q75_h2_box.webp><img alt="Programmer&rsquo;s File Editor Logo" title="Programmer&rsquo;s File Editor Logo" src=pfe.logo.jpg loading=lazy class=img-fluid></picture></a><figcaption>The brushed steel effect is how you know we're going to be working close to the metal.</figcaption></figure></p></p><h1 id=installing-windows-95-osr-21>Installing Windows 95 OSR 2.1 <a href=#installing-windows-95-osr-21 class=anchor>üîó</a></h1><p>To install Win95 in VirtualBox I followed <a href=https://socket3.wordpress.com/2016/09/06/install-configure-windows-95-using-oracle-virtualbox/ target=_blank rel=noopener>Socket3&rsquo;s blog post on the subject</a>. If you&rsquo;re following along you&rsquo;ll want to download the following:</p><ol><li><a href=https://winworldpc.com/product/windows-95/osr-21 target=_blank rel=noopener>Windows 95 OSR 2.1 OEM CDROM ISO</a></li><li><a href="https://drive.google.com/open?id=0B2BOLB8yC3mnTWtwSVk0X0NpZEE" target=_blank rel=noopener>Windows 95 Bootdisk floppy disk image</a></li><li><a href="https://drive.google.com/open?id=0B2BOLB8yC3mnbUg3YTVYd0JlU1U" target=_blank rel=noopener>SciTech Display Doctor 7.0 Beta</a></li></ol><p>You will also need a valid Win95 <em>&ldquo;Certificate of Authenticity&rdquo;</em> serial number. These are all over the internet but I&rsquo;ll save you a Google and share the one I used (<em>if you&rsquo;re a cop stop reading this</em>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-text data-lang=text><span style=display:flex><span>24796-OEM-0014736-66386
</span></span></code></pre></div><p>I chose to use some virtual machine settings that aren&rsquo;t true to the period to make life a little more bearable. I created a VM with a Pentium processor, 64mb of RAM and a 2GB disk. Don&rsquo;t forget to disable VT-x/AMD-V and Nested Paging in the CPU settings.</p><p>Using a floppy disk image to bootstrap CDROM drivers to be able to run the Win95 installer CD is certainly nostalgic. In the VM the overall install time is quite fast compared to 1995 when it would often take most of an hour.</p><p><p class=markdown-image><figure><a href=/posts/setup/banana.driver.jpg><picture><source media="(max-width: 420px)" srcset=/posts/setup/banana.driver_hue5b36e511681e484691128f48f6ade42_28176_400x0_resize_q75_h2_box.webp><source media="(max-width: 920px)" srcset=/posts/setup/banana.driver_hue5b36e511681e484691128f48f6ade42_28176_600x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/posts/setup/banana.driver_hue5b36e511681e484691128f48f6ade42_28176_800x0_resize_q75_h2_box.webp><img alt="Windows 95 Bootdisk output" title="Windows 95 Bootdisk output" src=banana.driver.jpg loading=lazy class=img-fluid></picture></a><figcaption>BANANA powered CD-ROM</figcaption></figure></p></p><p>Socket3&rsquo;s instructions worked as described except for a few minor things I had to adapt:</p><ol><li>The CDROM drive did not default to drive <code>R:\</code> - instead it was drive <code>D:\</code> like I would have expected. I replaced any references to <code>R:\</code> with <code>D:\</code>. I also skipped editing <code>autoexec.bat</code> to rename the CDROM drive.
Despite it being drive <code>D:\</code> I did have to follow the described process of copying
<code>*.cab</code> files from the CDROM to the harddrive before starting the installation process or trouble would ensue.</li><li>The process of copying CDROM files to drive <code>C:\</code> in Socket3&rsquo;s post is described before the <code>fdisk</code> and format process that prepares drive <code>C:\</code>. I had to reverse this order and prepare the drive before copying to it. Remember to restart the VM after partitioning and formatting.</li></ol><p><p class=markdown-image><figure><a href=/posts/setup/win95.installer.jpg><picture><source media="(max-width: 420px)" srcset=/posts/setup/win95.installer_hu9212027f1315f9131b74b88ac99a00d8_58222_400x0_resize_q75_h2_box.webp><source media="(max-width: 920px)" srcset=/posts/setup/win95.installer_hu9212027f1315f9131b74b88ac99a00d8_58222_600x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/posts/setup/win95.installer_hu9212027f1315f9131b74b88ac99a00d8_58222_800x0_resize_q75_h2_box.webp><img alt="Windows 95 Installer Screenshot" title="Windows 95 Installer Screenshot" src=win95.installer.jpg loading=lazy class=img-fluid></picture></a><figcaption>I'm having Fun‚Ñ¢ already</figcaption></figure></p></p><p>Getting the somewhat sketchy SciTech Display Doctor driver installed and configured is a little fiddly but the improved screen resolution is worth it. I had to drag around the SciTech application interface a bit before I could see the &ldquo;Apply&rdquo; button I needed to click to change the Display and Graphics Drivers to follow Socket3&rsquo;s instructions.</p><p>Following the network setup instructions was important to me because I knew I would want to copy files to the VM from my host machine (installers, goat files, etc). If you want to do the same make sure not to forget to reinstall &ldquo;Client for Microsoft Networks&rdquo; after you install the TCP/IP protocol because it will be removed when you first remove NetBEUI and IPX/SPX. I put the VM on a network that did not have a DHCP server and so I also had to configure the system IP Address, Gateway, and DNS Configuration manually. Get used to restarting your VM because <em>Literally Everything</em> requires rebooting in Windows 95: installing a new driver, changing the screen resolution, changing the system IP address, you name it.</p><p>One important thing to point out is that Socket3&rsquo;s approach to VM networking bridges the VM to your host machine&rsquo;s network adapter which means <strong>you may effectively be putting a Windows 95 machine on the big scary Internet unless you&rsquo;re careful</strong>. I gave up on using VirtualBox NAT so ultimately I &ldquo;airgap&rdquo; the VM by strategically connecting/disconnecting the network adapter virtual cable when I want to send/receive files. The irony of getting a virus while trying to develop a virus would be too much for me to bear.</p><h2 id=setting-up-file-sharing>Setting up File Sharing <a href=#setting-up-file-sharing class=anchor>üîó</a></h2><p>There are no VirtualBox guest additions for Windows95 which means I couldn&rsquo;t use conventional means to share files between the host and the guest. I tried mounting the VM&rsquo;s FAT32 disk image directly into Linux using various tricks but found it unreliable and annoying because the guest had to be shut down first. Out of the box Win95 OSR 2.1 has IE 4.0 so browsing the web to download tools is a nightmare. Barely any sites will work and prolonged exposure to the wild internet is almost guaranteed to leave you more hacked than Marriott. The best solution I could find without getting lost in yak shaving was to enable Windows file sharing in the VM. I use a Linux samba client from my host machine to interact with the VM shared folder.</p><p>File sharing isn&rsquo;t enabled out of the box so after configuring TCP/IP and connecting the virtual cable again (<em>plz don&rsquo;t hack me</em>) I enabled and configured it. To do so yourself:</p><ol><li>Right click Network Neighbourhood and choose properties</li><li>Click the ugly button labelled &ldquo;File and Print Sharing&rdquo;</li><li>Click <em>&ldquo;I want to be able to give others access to my files&rdquo;</em></li><li>Click OK</li><li>Insert the Windows 95 install CDROM again if you&rsquo;ve removed it</li><li>Click Yes to restart your computer (of course you have to restart your computer for this)</li><li>Create a folder in your C:\ drive called &ldquo;portal&rdquo;</li><li>Right click the folder and choose properties</li><li>Click the &ldquo;Sharing&rdquo; tab</li><li>Configure a share name and access type for the folder</li><li>I found it easiest to access the shared folder on the VM from my host using a command line SMB client called, unsurprisingly, <code>smbclient</code>. To download a TAR archive of some files in the portal directory is as easy as running:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>smbclient //VMNAME/PORTAL <span style=color:#e6db74>&#34;&#34;</span> -N -Tc backup.<span style=color:#66d9ef>$(</span>date +%Y-%m-%d-%s<span style=color:#66d9ef>)</span>.tar &lt;files&gt;
</span></span></code></pre></div><p>To poke around in an interactive mode is even easier:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>smbclient //VMNAME/PORTAL <span style=color:#e6db74>&#34;&#34;</span>
</span></span></code></pre></div><p>The <a href=https://jlk.fjfi.cvut.cz/arch/manpages/man/smbclient.1 target=_blank rel=noopener>smbclient man page</a> has plenty more information. Remember to disconnect the virtual network cable when you&rsquo;re done. Also note that <code>"VMNAME"</code> in the above commands is a placeholder for the name I chose to identify the computer in Windows file sharing settings, not the VirtualBox VM name.</p><p><p class=markdown-image><figure><a href=/posts/setup/network.settings.1.jpg><picture><source media="(max-width: 420px)" srcset=/posts/setup/network.settings.1_hu481cd7b94f292dd0002521e1c7fb084f_29372_400x0_resize_q75_h2_box.webp><source media="(max-width: 920px)" srcset=/posts/setup/network.settings.1_hu481cd7b94f292dd0002521e1c7fb084f_29372_600x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/posts/setup/network.settings.1_hu481cd7b94f292dd0002521e1c7fb084f_29372_800x0_resize_q75_h2_box.webp><img alt="Win95 Network Settings screenshot" title="Win95 Network Settings screenshot" src=network.settings.1.jpg loading=lazy class=img-fluid></picture></a><figcaption>Enabling file and print sharing.</figcaption></figure></p></p><p><p class=markdown-image><figure><a href=/posts/setup/network.settings.2.jpg><picture><source media="(max-width: 420px)" srcset=/posts/setup/network.settings.2_hu0cc1c993ba01bf68e67effffbd5ccc8f_28889_400x0_resize_q75_h2_box.webp><source media="(max-width: 920px)" srcset=/posts/setup/network.settings.2_hu0cc1c993ba01bf68e67effffbd5ccc8f_28889_600x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/posts/setup/network.settings.2_hu0cc1c993ba01bf68e67effffbd5ccc8f_28889_800x0_resize_q75_h2_box.webp><img alt="Win95 File and Print Sharing screenshot" title="Win95 File and Print Sharing screenshot" src=network.settings.2.jpg loading=lazy class=img-fluid></picture></a><figcaption>Enabling file and print sharing pt2.</figcaption></figure></p></p><p><p class=markdown-image><figure><a href=/posts/setup/file.sharing.settings.jpg><picture><source media="(max-width: 420px)" srcset=/posts/setup/file.sharing.settings_hu13a5baa574485b729828ff71e5974e72_23378_400x0_resize_q75_h2_box.webp><source media="(max-width: 920px)" srcset=/posts/setup/file.sharing.settings_hu13a5baa574485b729828ff71e5974e72_23378_600x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/posts/setup/file.sharing.settings_hu13a5baa574485b729828ff71e5974e72_23378_800x0_resize_q75_h2_box.webp><img alt="Win95 File Sharing Properties screenshot" title="Win95 File Sharing Properties screenshot" src=file.sharing.settings.jpg loading=lazy class=img-fluid></picture></a><figcaption>Configuring a file share.</figcaption></figure></p></p><h1 id=installing-borland-turbo-assembler-50>Installing Borland Turbo Assembler 5.0 <a href=#installing-borland-turbo-assembler-50 class=anchor>üîó</a></h1><p>Overall this was a straight-forward process. To begin I had to download the three floppy disk images for the Borland Turbo Assembler 5.0 installer. You can find these on Win32World as a <a href=https://winworldpc.com/product/turbo-assembler/5x target=_blank rel=noopener>7z archive</a>. If you&rsquo;re following along you&rsquo;ll need a way to unzip 7z files to get at the individual disk images you can mount as virtual floppy disks for the VM using VirtualBox.</p><p>After mounting <code>disk01.img</code> to the virtual floppy drive I was able to begin the installation. One way to do this is to:</p><ol><li>Open My Computer</li><li>Double click the <code>A:\</code> drive</li><li>Double click the &ldquo;Install&rdquo; icon</li><li>Hit enter as required to proceed</li><li>Leave all the defaults and choose Start Installation</li><li>Mount disk #2 and disk #3 when prompted</li><li>When <code>TSM_RDME.TXT</code> is displayed the installation is complete. Hit ESC to exit. 1. Don&rsquo;t forget to eject the floppy disk before you reboot the VM or the next boot-up will try to boot from the Borland floppy and fail.</li></ol><p><p class=markdown-image><figure><a href=/posts/setup/tasm5.splash.jpg><picture><source media="(max-width: 420px)" srcset=/posts/setup/tasm5.splash_hu0441ef6bb04741d4255903a8bae48b22_57930_400x0_resize_q75_h2_box.webp><source media="(max-width: 920px)" srcset=/posts/setup/tasm5.splash_hu0441ef6bb04741d4255903a8bae48b22_57930_600x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/posts/setup/tasm5.splash_hu0441ef6bb04741d4255903a8bae48b22_57930_800x0_resize_q75_h2_box.webp><img alt="TASM5 Installer Screen" title="TASM5 Installer Screen" src=tasm5.splash.jpg loading=lazy class=img-fluid></picture></a><figcaption>T-t-t-t-turbooooooo</figcaption></figure></p></p><p>Next I had to add the TASM tools to the <code>%PATH%</code> environment variable so I can use the tools easily from a command prompt without a fully qualified path. For Win95 this means editing the <code>Autoexec.bat</code> script. One way to do so:</p><ol><li>Open My Computer</li><li>Open the <code>C:\</code> drive</li><li>Right click &ldquo;Autoexec&rdquo; and choose &ldquo;Edit&rdquo;</li><li>The file will probably be empty since this is a fresh installation. I added the following line: <code>Set PATH=%PATH%;C:\TASM\BIN</code></li><li>Save the file and exit</li><li>Reboot (of course)</li></ol><p>I was able to verify that I had a working installation and gain some basic familiarity with the tools by building one of the Win32 sample applications that comes with TASM. To do this:</p><ol><li>Open a command prompt (My favourite way is to hold the windows key, hit &ldquo;r&rdquo;, enter <code>command</code> and then hit enter)</li><li>Change to the &ldquo;wap32&rdquo; example directory by running <code>cd C:\TASM\EXAMPLES\WAP32</code>
Build the sample application by running <code>make</code>. If you get the error &ldquo;Bad command or file name&rdquo; you should double check your <code>%PATH%</code> was setup correctly. It&rsquo;s expected to see two warning messages about heap and stack reserve size (<em>Shout out to the Borland dev that shipped example code that builds with warnings&mldr;</em>).</li><li>Run the built application by running <code>wap32</code> in the console</li><li>You should see an ugly win32 application window appear</li><li>You can try debugging the application by running <code>td32 wap32</code>. Because we built the sample application without debug symbols the debugger will warn us about this fact and only show disassembled machine code</li><li>You can try debugging <strong>with</strong> symbols by running <code>make -B -DDEBUG</code>. The <code>-B</code> forces a rebuild even though the sourcecode hasn&rsquo;t changed. <code>-DDEBUG</code> passes a <code>DEBUG</code> argument to the <code>Makefile</code> so it can change the assembler and linker command line flags</li><li>After rebuilding with debug symbols you can run <code>td32 wap32</code> again and it should not warn about missing debug symbols anymore and instead show you a source code listing. Much nicer!</li></ol><p><p class=markdown-image><figure><a href=/posts/setup/wap32.build.output.jpg><picture><source media="(max-width: 420px)" srcset=/posts/setup/wap32.build.output_hu4463f85b170de7bba605f99a058e9dbd_53346_400x0_resize_q75_h2_box.webp><source media="(max-width: 920px)" srcset=/posts/setup/wap32.build.output_hu4463f85b170de7bba605f99a058e9dbd_53346_600x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/posts/setup/wap32.build.output_hu4463f85b170de7bba605f99a058e9dbd_53346_800x0_resize_q75_h2_box.webp><img alt="WAP32 Build Output" title="WAP32 Build Output" src=wap32.build.output.jpg loading=lazy class=img-fluid></picture></a><figcaption>Building the wap32 example without debug symbols.</figcaption></figure></p></p><p><p class=markdown-image><figure><a href=/posts/setup/wap32.running.jpg><picture><source media="(max-width: 420px)" srcset=/posts/setup/wap32.running_hud3f7411567ced20333fb505fa12bdce3_28953_400x0_resize_q75_h2_box.webp><source media="(max-width: 920px)" srcset=/posts/setup/wap32.running_hud3f7411567ced20333fb505fa12bdce3_28953_600x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/posts/setup/wap32.running_hud3f7411567ced20333fb505fa12bdce3_28953_800x0_resize_q75_h2_box.webp><img alt="WAP32 Screenshot" title="WAP32 Screenshot" src=wap32.running.jpg loading=lazy class=img-fluid></picture></a><figcaption>WAP32.EXE in all its glory.</figcaption></figure></p></p><p><p class=markdown-image><figure><a href=/posts/setup/td32.no.symbols.jpg><picture><source media="(max-width: 420px)" srcset=/posts/setup/td32.no.symbols_hufa0d3c821bcd9c3109cd39b14d4cc022_87117_400x0_resize_q75_h2_box.webp><source media="(max-width: 920px)" srcset=/posts/setup/td32.no.symbols_hufa0d3c821bcd9c3109cd39b14d4cc022_87117_600x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/posts/setup/td32.no.symbols_hufa0d3c821bcd9c3109cd39b14d4cc022_87117_800x0_resize_q75_h2_box.webp><img alt="TD32 Debugging wap32 without symbols" title="TD32 Debugging wap32 without symbols" src=td32.no.symbols.jpg loading=lazy class=img-fluid></picture></a><figcaption>Debugging wap32 without debug symbols.</figcaption></figure></p></p><p><p class=markdown-image><figure><a href=/posts/setup/td32.symbols.jpg><picture><source media="(max-width: 420px)" srcset=/posts/setup/td32.symbols_hueeb5f1ef71c57d5b2dd7a548687b8f22_57612_400x0_resize_q75_h2_box.webp><source media="(max-width: 920px)" srcset=/posts/setup/td32.symbols_hueeb5f1ef71c57d5b2dd7a548687b8f22_57612_600x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/posts/setup/td32.symbols_hueeb5f1ef71c57d5b2dd7a548687b8f22_57612_800x0_resize_q75_h2_box.webp><img alt="TD32 Debugging wap32 with symbols" title="TD32 Debugging wap32 with symbols" src=td32.symbols.jpg loading=lazy class=img-fluid></picture></a><figcaption>Debugging wap32 with debug symbols.</figcaption></figure></p></p><h1 id=wrapping-up>Wrapping Up <a href=#wrapping-up class=anchor>üîó</a></h1><p>Cool! A real development environment. If you followed along I recommend that you create a snapshot of the VM state at this point so no matter how screwed up things get you can always return to a fresh setup. It would also be useful to duplicate these setup instructions to make a few more Windows 95 VMs that you can use to test your virus down the road without infecting your development machine.</p><p><p class=markdown-image><figure><a href=/posts/setup/full.dev.env.jpg><picture><source media="(max-width: 420px)" srcset=/posts/setup/full.dev.env_hudea82672b2940bb48722bc11079da05d_210919_400x0_resize_q75_h2_box.webp><source media="(max-width: 920px)" srcset=/posts/setup/full.dev.env_hudea82672b2940bb48722bc11079da05d_210919_600x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/posts/setup/full.dev.env_hudea82672b2940bb48722bc11079da05d_210919_800x0_resize_q75_h2_box.webp><img alt="Win95 Desktop Screenshot" title="Win95 Desktop Screenshot" src=full.dev.env.jpg loading=lazy class=img-fluid></picture></a><figcaption>A full development environment in action</figcaption></figure></p></p><p><em><strong>Bonus fact:</strong> If you&rsquo;ve read <a href=https://fabiensanglard.net/ target=_blank rel=noopener>Fabien Sanglard</a>&rsquo;s excellent <a href=http://fabiensanglard.net/gebbwolf3d/index.html target=_blank rel=noopener>Game Engine Black Book: Wolfenstein 3D</a> you might noticed the td32 debugger interface looks just like the one shown in Chapter 3. John Carmack and id software used Borland Turbo C++ for the development of Wolf 3D and it came bundled with Borland Turbo Debugger (though we&rsquo;ve installed a newer version).</em></p><p>At this point I spent most of my time reading the <a href=https://binaryparadox.net/d/tasm.pdf target=_blank rel=noopener>Borland Turbo Assembler 5.0 manual</a> and browsing through the WAP32 source code. It was a pretty good starting example for win32 programming in x86 assembly. Once I had a grasp of WAP32 I dipped my toes into some of <a href=http://win32assembly.programminghorizon.com/tutorials.html target=_blank rel=noopener>Iczelion&rsquo;s tutorials</a>. These are mostly MASM based but work with TASM with minimal fuss. Compared to 2019&rsquo;s version of development tutorials and medium dot com think-pieces I found these older &ldquo;community style&rdquo; tutorials very endearing if not always crystal clear.</p><p>You might have been surprised to see the <code>make</code> command show up in a Win95 dev environment. I admit I was. Initially I assumed it would be something similar to GNU Make and I definitely set myself up for disappointment. In reality it&rsquo;s some kind of proprietary <a href=ftp://ftp.kis.p.lodz.pl/pub/people/T.Koszmider/Bp/tasm/doc/make.txt>Borland flavour of Make</a> that is missing a lot of what I associate with GNU Make. It takes some getting used to, especially when paired with the lousy <code>command.exe</code> shell Win95 offers. Overall it&rsquo;s still nicer (<em>to me anyway</em>) than writing <code>BAT</code> files.</p><p>With the dev env ready I can move on to more interesting topics. Next time I&rsquo;d like to talk about the theory behind PE infectors and some challenges that we&rsquo;ll face compared to standard application development.</p><p>I would love to hear feedback about this project, especially if you were someone writing assembly code in this era. Feel free to drop me a line on twitter (<a href=https://twitter.com/cpu target=_blank rel=noopener>@cpu</a>) or by email (<a href=mailto://daniel@binaryparadox.net>daniel@binaryparadox.net</a>).</p><p>Until next time,</p></div><nav class=bottom_nav><ul><li style=flex:1><a rel=prev href=https://log.vexation.ca/posts/welcome/>‚Üê Let's write a virus</a></li><li style="flex:1 0 80px;text-align:center"><button onclick="document.body.scrollTop=0,document.documentElement.scrollTop=0,event.preventDefault()">
‚Üë Back to top</button></li><li style=flex:1><a href=https://log.vexation.ca/posts/pe-infector-basics/>PE File Infector Basics ‚Üí</a></li></ul></nav></section></main><footer id=footer><div id=social><a class=symbol href=https://github.com/cpu/vexation rel=me target=_blank><svg fill="#bbb" width="28" height="28" viewBox="0 0 72 72" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>Github</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)"><g id="Github" transform="translate(264.000000, 939.000000)"><path d="M8 72H64c4.418278.0 8-3.581722 8-8V8c0-4.418278-3.581722-8-8-8H8c-4.418278 811624501e-24-8 3.581722-8 8V64c541083001e-24 4.418278 3.581722 8 8 8z" id="Rounded" fill="#bbb"/><path d="M35.9985 13C22.746 13 12 23.7870921 12 37.096644c0 10.6440272 6.876 19.6751861 16.4145 22.8617681C29.6145 60.1797862 30.0525 59.4358488 30.0525 58.7973276 30.0525 58.2250681 30.0315 56.7100863 30.0195 54.6996482c-6.6765 1.4562499-8.085-3.2302544-8.085-3.2302544-1.0905-2.7829884-2.664-3.5239139-2.664-3.5239139C17.091 46.4500754 19.4355 46.4801943 19.4355 46.4801943c2.4075.1701719 3.675 2.4833051 3.675 2.4833051 2.142 3.6820383 5.6175 2.6188404 6.9855 2.0014024C30.3135 49.4077535 30.9345 48.3460615 31.62 47.7436831 26.2905 47.1352808 20.688 45.0691228 20.688 35.8361671c0-2.6308879.9345-4.781379 2.4705-6.4665327C22.911 28.7597262 22.0875 26.3110578 23.3925 22.9934585c0 0 2.016-.6475568 6.6 2.4697516C31.908 24.9285993 33.96 24.6620468 36.0015 24.6515052 38.04 24.6620468 40.0935 24.9285993 42.0105 25.4632101c4.581-3.1173084 6.5925-2.4697516 6.5925-2.4697516C49.9125 26.3110578 49.089 28.7597262 48.8415 29.3696344 50.3805 31.0547881 51.309 33.2052792 51.309 35.8361671c0 9.2555448-5.6115 11.29309-10.9575 11.8894446.860999999999997.7439374 1.629 2.2137408 1.629 4.4621184C41.9805 55.4089489 41.9505 58.0067059 41.9505 58.7973276 41.9505 59.4418726 42.3825 60.1918338 43.6005 59.9554002 53.13 56.7627944 60 47.7376593 60 37.096644 60 23.7870921 49.254 13 35.9985 13" fill="#fff"/></g></g></g></svg></a><a class=symbol href=https://twitter.com/cpu rel=me target=_blank><svg fill="#bbb" width="28" height="28" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="438.536" height="438.536" viewBox="0 0 438.536 438.536" style="enable-background:new 0 0 438.536 438.536"><g><path d="M414.41 24.123C398.333 8.042 378.963.0 356.315.0H82.228C59.58.0 40.21 8.042 24.126 24.123 8.045 40.207.003 59.576.003 82.225v274.084c0 22.647 8.042 42.018 24.123 58.102 16.084 16.084 35.454 24.126 58.102 24.126h274.084c22.648.0 42.018-8.042 58.095-24.126 16.084-16.084 24.126-35.454 24.126-58.102V82.225C438.532 59.576 430.49 40.204 414.41 24.123zM335.471 168.735c.191 1.713.288 4.278.288 7.71.0 15.989-2.334 32.025-6.995 48.104-4.661 16.087-11.8 31.504-21.416 46.254-9.606 14.749-21.074 27.791-34.396 39.115-13.325 11.32-29.311 20.365-47.968 27.117-18.648 6.762-38.637 10.143-59.953 10.143-33.116.0-63.76-8.952-91.931-26.836 4.568.568 9.329.855 14.275.855 27.6.0 52.439-8.565 74.519-25.7-12.941-.185-24.506-4.179-34.688-11.991-10.185-7.803-17.273-17.699-21.271-29.691 4.947.76 8.658 1.137 11.132 1.137 4.187.0 9.042-.76 14.56-2.279-13.894-2.669-25.598-9.562-35.115-20.697-9.519-11.136-14.277-23.84-14.277-38.114v-.571c10.085 4.755 19.602 7.229 28.549 7.422-17.321-11.613-25.981-28.265-25.981-49.963.0-10.66 2.758-20.747 8.278-30.264 15.035 18.464 33.311 33.213 54.816 44.252 21.507 11.038 44.54 17.227 69.092 18.558-.95-3.616-1.427-8.186-1.427-13.704.0-16.562 5.853-30.692 17.56-42.399 11.703-11.706 25.837-17.561 42.394-17.561 17.515.0 32.079 6.283 43.688 18.846 13.134-2.474 25.892-7.33 38.26-14.56-4.757 14.652-13.613 25.788-26.55 33.402 12.368-1.716 23.88-4.95 34.537-9.708C357.458 149.793 347.462 160.166 335.471 168.735z"/></g></svg></a></div><div class=copyright>¬© Copyright
2022
<span class=split><a style=text-decoration:none;color:currentColor;cursor:not-allowed href=https://monkeypunch.biz>‚ò†</a></span>
Daniel McCarney</div></footer></body></html>