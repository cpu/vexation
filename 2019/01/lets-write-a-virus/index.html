<!doctype html><html lang=en-us><head><title>Let's write a virus | VeXation</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="A trip back to the 1990s and a journey into Win95 virus development."><meta name=generator content="Hugo 0.99.1"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><meta property="og:title" content="Let's write a virus"><meta property="og:description" content="A trip back to the 1990s and a journey into Win95 virus development."><meta property="og:type" content="article"><meta property="og:url" content="https://log.vexation.ca/2019/01/lets-write-a-virus/"><meta property="og:image" content="https://log.vexation.ca/2019/01/lets-write-a-virus/feature.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-01-14T00:00:00+00:00"><meta property="article:modified_time" content="2019-01-14T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://log.vexation.ca/2019/01/lets-write-a-virus/feature.jpg"><meta name=twitter:title content="Let's write a virus"><meta name=twitter:description content="A trip back to the 1990s and a journey into Win95 virus development."><meta name=twitter:site content="@https://twitter.com/cpu"><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/custom.css><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon></head><body><nav class=navigation><a href=/><span class=arrow>‚Üê</span>Home</a>
<a href=/posts>Archive</a>
<a href=/about>About</a>
<a class=button href=https://log.vexation.ca/index.xml>Subscribe</a></nav><main class=main><section id=single><h1 class=title>Let's write a virus</h1><div class=tip><time datetime="2019-01-14 00:00:00 +0000 UTC">Jan 14, 2019</time></div><aside class=toc><details><summary>Table of Contents</summary><div><nav id=TableOfContents><ul><li><a href=#why-a-virus>Why a virus?</a></li><li><a href=#why-a-90s-virus>Why a 90s virus?</a></li><li><a href=#why-a-windows-95-virus>Why a Windows 95 virus?</a></li><li><a href=#where-to-start>Where to start?</a></li><li><a href=#up-next>Up Next</a></li></ul></nav></div></details></aside><div class=content><p>Over the 2018 Christmas holiday I decided to sit down and start on a project that has been on my mind for a long time: writing a 90s computer virus. This blog exists to chronicle my progress and hopefully spark your interest in retro computer viruses.</p><h1 id=why-a-virus>Why a virus? <a href=#why-a-virus class=anchor>üîó</a></h1><p>Growing up I was enamoured with <a href=http://textfiles.com/hacking/ target=_blank rel=noopener>the .txt files that came out of what was then called the &ldquo;computer underground&rdquo;</a>. Within this space of angsty teens and early internet culture I was particularly in love with a corner mostly referred to as &ldquo;VX&rdquo; for <em><strong>V</strong>irus e<strong>X</strong>change</em>. Here you&rsquo;d find people like <em>&ldquo;Lord Julus&rdquo;</em> writing posts with names like <a href=http://ivanlef0u.fr/repo/madchat/vxdevl/vdat/tuantant.htm target=_blank rel=noopener>&ldquo;Anti-Debugger & Anti-Emulator Lair&rdquo;</a> and groups like <a href=https://cryptohub.nl/zines/vxheavens/29a/index.htm target=_blank rel=noopener>29a</a> (666 in hexadecimal - I hope you can already see the appeal) putting out ezines and prototype virii.</p><p><p class=markdown-image><figure><a href=/2019/01/lets-write-a-virus/29a.landing.png><picture><source media="(max-width: 420px)" srcset=/2019/01/lets-write-a-virus/29a.landing_hu11f1f558dbc1a4f0f0f6c21b7f23cd7c_133502_400x0_resize_q75_h2_box_3.webp><source media="(max-width: 920px)" srcset=/2019/01/lets-write-a-virus/29a.landing_hu11f1f558dbc1a4f0f0f6c21b7f23cd7c_133502_600x0_resize_q75_h2_box_3.webp><source media="(max-width: 1400px)" srcset=/2019/01/lets-write-a-virus/29a.landing_hu11f1f558dbc1a4f0f0f6c21b7f23cd7c_133502_800x0_resize_q75_h2_box_3.webp><img alt="29a&rsquo;s Website Landing Page" title="29a&rsquo;s Website Landing Page" src=29a.landing.png loading=lazy class=img-fluid></picture></a><figcaption>Remember when all sites had landing pages?</figcaption></figure></p></p><p>Much of this era was painstakingly catalogued on a website called <em>&ldquo;VX Heavens&rdquo;</em>. While its original home <a href=https://nakedsecurity.sophos.com/2012/03/28/vx-heavens-virus-writing-website-raided/ target=_blank rel=noopener>met an unfair demise</a> there are still <a href="https://cryptohub.nl/zines/vxheavens/lib/-index=OT&lang=en.htm" target=_blank rel=noopener>mirrors online</a> and <a href=https://archive.org/details/vxheavens-2010-05-18 target=_blank rel=noopener>archives</a> to download. There were certainly problematic aspects of the VX scene I can&rsquo;t commend but the spirit of creativity, discovery and sharing of knowledge was truly unique.</p><h1 id=why-a-90s-virus>Why a 90s virus? <a href=#why-a-90s-virus class=anchor>üîó</a></h1><p>For broader context, in 1995 I was 7 years old. I was probably closer to 12 when I first started reading vx files. I probably understood less than 2% of anything I read at the time. Revisiting this subject today with a decade of professional experience is fascinating. Now I can both enjoy the spirit that appealed to me as a kid while also appreciating and implementing the technical aspects.</p><p>Despite being over 20 years old lots of the techniques detailed by great VXers of the era remain relevant fundamentals. The core technologies addressed by many articles still exist and are in use. In fact I bet whatever computer you&rsquo;re reading this on right now is still executing <code>PE</code> or <code>ELF</code> executables.</p><p>It may not be reflected in citations and RSA conference talks but topics that are now foundational areas of computer security and reverse engineering were pioneered not by academia or industry but by bored teenagers who wanted to <a href=https://archive.org/details/malware_COFFSHOP.COM target=_blank rel=noopener>make other people&rsquo;s computers show a weed leaf</a>.</p><h1 id=why-a-windows-95-virus>Why a Windows 95 virus? <a href=#why-a-windows-95-virus class=anchor>üîó</a></h1><p>To start writing a virus I needed to decide on platforms and targets to support. My choice of Windows 95 was driven by both practical and emotional reasons.</p><p>From a historic standpoint Win95 marked an interesting inflection point in the VX scene. The DOS era had <a href="https://www.youtube.com/watch?v=xgS1M4e_9_E" target=_blank rel=noopener>huge number of viruses</a> and VX publications but with the release of Win95 much of the community&rsquo;s knowledge was becoming obsolete. Just to start Win95 had <a href=https://msdn.microsoft.com/en-us/library/ms809762.aspx target=_blank rel=noopener>a brand new executable format</a>, ran in <a href=https://en.wikipedia.org/wiki/Protected_mode target=_blank rel=noopener>protected mode</a>, and operating system functions were accessed through a new API instead of <a href=http://stanislavs.org/helppc/int_21.html target=_blank rel=noopener>raw interrupts</a>.</p><p><p class=markdown-image><figure><a href=/2019/01/lets-write-a-virus/win95.with.friends.jpg><picture><source media="(max-width: 420px)" srcset=/2019/01/lets-write-a-virus/win95.with.friends_hu9a00bd426d294a36b1d3c07ede7d0d7e_56254_400x0_resize_q75_h2_box.webp><source media="(max-width: 920px)" srcset=/2019/01/lets-write-a-virus/win95.with.friends_hu9a00bd426d294a36b1d3c07ede7d0d7e_56254_600x0_resize_q75_h2_box.webp><source media="(max-width: 1400px)" srcset=/2019/01/lets-write-a-virus/win95.with.friends_hu9a00bd426d294a36b1d3c07ede7d0d7e_56254_800x0_resize_q75_h2_box.webp><img alt="Win95 Video Guide with Jennifer Aniston and Matthew Perry" title="Win95 Video Guide with Jennifer Aniston and Matthew Perry" src=win95.with.friends.jpg loading=lazy class=img-fluid></picture></a><figcaption>There are so many great Win95 resources available.</figcaption></figure></p></p><p>Windows 95 was also the first operating system I can remember exploring. My first computer was a <a href=https://en.wikipedia.org/wiki/Tandy_1000 target=_blank rel=noopener>Tandy 1000</a> but it was fairly primitive and I was too young to explore deeply. By the time my family had a Win95 machine I was obsessed with it. I spent a lot of time looking at every single control panel setting and corner of the filesystem. We didn&rsquo;t have home Internet at the time so what counted as &ldquo;fun&rdquo; on the computer was certainly broader than today. I&rsquo;m sure many of you that grew up in this time remember hours lost in <code>mspaint.exe</code>.</p><p>From a practical standpoint Win95 is appealing because it is modern enough to have things that will make my life easier (TCP/IP, filesharing, approachable development tools, a flat memory space, basically zero security features). It also runs reasonably well in VirtualBox so I can avoid purchasing any beige monstrosities on eBay.</p><p>For a challenge and to match VXer preference of the time I&rsquo;ll be writing my virus in pure <a href=https://en.wikipedia.org/wiki/X86_assembly_language target=_blank rel=noopener>x86 assembly</a>. I have limited experience writing assembly so I wanted to be sure I picked a platform that wasn&rsquo;t too esoteric. There&rsquo;s a good deal of resources available about both general Win32 programming in assembly, as well as VX specific resources for Win95. I&rsquo;ve spent most of my career focused on Linux and UNIX systems so there&rsquo;s a lot of new ground for me to cover programming on and for Windows.</p><p>Lastly, targeting an operating system <a href="https://support.microsoft.com/en-us/lifecycle/search?alpha=Microsoft%20Windows%2095" target=_blank rel=noopener>18 years past the end of extended support</a> means I can experiment with virus writing without worrying too much about destructive consequences and moral hangups. Don&rsquo;t run Windows 95 in the real world, I&rsquo;m begging you.</p><h1 id=where-to-start>Where to start? <a href=#where-to-start class=anchor>üîó</a></h1><p>With some of the &ldquo;Why&rdquo; out of the way let&rsquo;s talk about short term goals and what I want to start out building.</p><ol><li><strong>Vanilla infector.</strong> My goal is to infect PE executables to propagate the virus without impacting the functionality of the infected application. Put simply, if you run an infected program it should work as intended to avert suspicion but also spread the virus by finding new programs to infect.</li><li><strong>KISS</strong>. To start I&rsquo;ll ignore advanced techniques (polymorphism, encryptors, anti-debugging, etc) and focus on a minimal viable PE infector. This means I will largely be ignoring anti-virus detection to start with. I&rsquo;ll point out where I&rsquo;m making a decision that will aid AVers but I will postpone developing countermeasures. (<em>Spoiler: Even using 90s tricks without concern for evasion will turn out to bypass detection from a surprising number of AV engines. More on that later&mldr;</em>)</li><li><strong>Windows 95 compatibility only.</strong> It isn&rsquo;t too difficult to also support Windows NT and Windows 98 but I&rsquo;m already biting off a lot so focusing on one platform will help manage complexity.</li><li><strong>No hard-coding offsets!</strong> Even though I&rsquo;m ignoring Windows NT and 98 I want to be reasonably confident the virus will run on different patch levels of Windows 95.</li><li><strong>100% assembly.</strong> It&rsquo;s tempting to use C but to make this more of a challenge and to match the preferences of the VX scene in this era I&rsquo;ll use <code>x86</code> assembly only (likely targeting the <code>80386</code> or <code>80486</code>).</li><li><strong>Period accurate tools.</strong> As much as anything I want to feel like a 90s Windows VXer and that means not using <code>vim</code> and a familiar toolset. Instead I&rsquo;ll find a 1990s text editor and use the compilers/debuggers available at the time.</li></ol><p>This is ambitious and I tend to abandon projects before they&rsquo;re finished so I hope
that by keeping the scope constrained initially and focusing on sharing in-progress work I can finish the above and move on to the more interesting advanced topics :-)</p><h1 id=up-next>Up Next <a href=#up-next class=anchor>üîó</a></h1><p>My next post will focus on setting up a Windows 95 VM, configuring it with internet access, setting up filesharing, and installing a <code>x86</code> assembly development environment.</p><p>I would love to hear feedback about this project, especially if you were someone active in the 90s vx scene. Feel free to drop me a line on twitter (<a href=https://twitter.com/cpu target=_blank rel=noopener>@cpu</a>) or by email (<a href=mailto://daniel@binaryparadox.net>daniel@binaryparadox.net</a>).</p><p>Until next time,</p></div><nav class=bottom_nav><ul><li style="flex:1 0 80px;text-align:center"><button onclick="document.body.scrollTop=0,document.documentElement.scrollTop=0,event.preventDefault()">
‚Üë Back to top</button></li><li style=flex:1><a href=https://log.vexation.ca/2019/01/getting-set-up/>Getting set up ‚Üí</a></li></ul></nav></section></main><footer id=footer><div id=social><a class=symbol href=https://github.com/cpu/vexation rel=me target=_blank><svg fill="#bbb" width="28" height="28" viewBox="0 0 72 72" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>Github</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)"><g id="Github" transform="translate(264.000000, 939.000000)"><path d="M8 72H64c4.418278.0 8-3.581722 8-8V8c0-4.418278-3.581722-8-8-8H8c-4.418278 811624501e-24-8 3.581722-8 8V64c541083001e-24 4.418278 3.581722 8 8 8z" id="Rounded" fill="#bbb"/><path d="M35.9985 13C22.746 13 12 23.7870921 12 37.096644c0 10.6440272 6.876 19.6751861 16.4145 22.8617681C29.6145 60.1797862 30.0525 59.4358488 30.0525 58.7973276 30.0525 58.2250681 30.0315 56.7100863 30.0195 54.6996482c-6.6765 1.4562499-8.085-3.2302544-8.085-3.2302544-1.0905-2.7829884-2.664-3.5239139-2.664-3.5239139C17.091 46.4500754 19.4355 46.4801943 19.4355 46.4801943c2.4075.1701719 3.675 2.4833051 3.675 2.4833051 2.142 3.6820383 5.6175 2.6188404 6.9855 2.0014024C30.3135 49.4077535 30.9345 48.3460615 31.62 47.7436831 26.2905 47.1352808 20.688 45.0691228 20.688 35.8361671c0-2.6308879.9345-4.781379 2.4705-6.4665327C22.911 28.7597262 22.0875 26.3110578 23.3925 22.9934585c0 0 2.016-.6475568 6.6 2.4697516C31.908 24.9285993 33.96 24.6620468 36.0015 24.6515052 38.04 24.6620468 40.0935 24.9285993 42.0105 25.4632101c4.581-3.1173084 6.5925-2.4697516 6.5925-2.4697516C49.9125 26.3110578 49.089 28.7597262 48.8415 29.3696344 50.3805 31.0547881 51.309 33.2052792 51.309 35.8361671c0 9.2555448-5.6115 11.29309-10.9575 11.8894446.860999999999997.7439374 1.629 2.2137408 1.629 4.4621184C41.9805 55.4089489 41.9505 58.0067059 41.9505 58.7973276 41.9505 59.4418726 42.3825 60.1918338 43.6005 59.9554002 53.13 56.7627944 60 47.7376593 60 37.096644 60 23.7870921 49.254 13 35.9985 13" fill="#fff"/></g></g></g></svg></a><a class=symbol href=https://twitter.com/cpu rel=me target=_blank><svg fill="#bbb" width="28" height="28" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="438.536" height="438.536" viewBox="0 0 438.536 438.536" style="enable-background:new 0 0 438.536 438.536"><g><path d="M414.41 24.123C398.333 8.042 378.963.0 356.315.0H82.228C59.58.0 40.21 8.042 24.126 24.123 8.045 40.207.003 59.576.003 82.225v274.084c0 22.647 8.042 42.018 24.123 58.102 16.084 16.084 35.454 24.126 58.102 24.126h274.084c22.648.0 42.018-8.042 58.095-24.126 16.084-16.084 24.126-35.454 24.126-58.102V82.225C438.532 59.576 430.49 40.204 414.41 24.123zM335.471 168.735c.191 1.713.288 4.278.288 7.71.0 15.989-2.334 32.025-6.995 48.104-4.661 16.087-11.8 31.504-21.416 46.254-9.606 14.749-21.074 27.791-34.396 39.115-13.325 11.32-29.311 20.365-47.968 27.117-18.648 6.762-38.637 10.143-59.953 10.143-33.116.0-63.76-8.952-91.931-26.836 4.568.568 9.329.855 14.275.855 27.6.0 52.439-8.565 74.519-25.7-12.941-.185-24.506-4.179-34.688-11.991-10.185-7.803-17.273-17.699-21.271-29.691 4.947.76 8.658 1.137 11.132 1.137 4.187.0 9.042-.76 14.56-2.279-13.894-2.669-25.598-9.562-35.115-20.697-9.519-11.136-14.277-23.84-14.277-38.114v-.571c10.085 4.755 19.602 7.229 28.549 7.422-17.321-11.613-25.981-28.265-25.981-49.963.0-10.66 2.758-20.747 8.278-30.264 15.035 18.464 33.311 33.213 54.816 44.252 21.507 11.038 44.54 17.227 69.092 18.558-.95-3.616-1.427-8.186-1.427-13.704.0-16.562 5.853-30.692 17.56-42.399 11.703-11.706 25.837-17.561 42.394-17.561 17.515.0 32.079 6.283 43.688 18.846 13.134-2.474 25.892-7.33 38.26-14.56-4.757 14.652-13.613 25.788-26.55 33.402 12.368-1.716 23.88-4.95 34.537-9.708C357.458 149.793 347.462 160.166 335.471 168.735z"/></g></svg></a></div><div class=copyright>¬© Copyright
2022
<span class=split><a style=text-decoration:none;color:currentColor;cursor:not-allowed href=https://monkeypunch.biz>‚ò†</a></span>
Daniel McCarney</div></footer></body></html>